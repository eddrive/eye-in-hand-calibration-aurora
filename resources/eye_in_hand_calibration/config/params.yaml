hand_eye_calibrator:
  ros__parameters:
    # ===========================================
    # TOPICS & FRAMES
    # ===========================================

    # Compressed image feed from endoscope camera
    image_topic: "/endoscope/image_raw/compressed"

    # Aurora tracking data topic (PoseStamped)
    aurora_topic: "/aurora/sensor0"

    # TF frame hierarchy: aurora_base -> endo_aurora -> [calibration] -> endo_optical
    parent_frame: "aurora_base"        # Fixed Aurora tracking reference
    child_frame: "endo_aurora"         # Aurora sensor on endoscope
    
    # ===========================================
    # CAMERA CALIBRATION
    # ===========================================
    
    # Intrinsic calibration file (camera_matrix, distortion_coeffs, model)
    # Generate with: ros2 run camera_calibration cameracalibrator
    camera_calibration_file: "/root/calibration/camera_calibration_fisheye_1080p.yaml"
    
    # ===========================================
    # COLLECTION PARAMETERS
    # ===========================================
    
    max_samples: 100                   # Total samples to collect
    final_poses: 20                    # Best samples used for calibration (diversity + quality)
    max_error_threshold: 0.05          # Max acceptable prediction error (m) - surgical precision
    max_pose_age_ms: 10                # Max time diff for Aurora-image sync (ms)
    aurora_buffer_size: 5000           # Circular buffer size for Aurora poses
    
    # ===========================================
    # CHESSBOARD PATTERN
    # ===========================================
    
    chessboard_rows: 10                 # Internal corners (not squares!)
    chessboard_cols: 8
    chessboard_square_size: 0.003     # Physical square size (m) - measure with calipers
    
    # Object points mode:
    #   false = ideal planar grid (Z=0, perfect spacing)
    #   true  = measured 3D coords from Aurora (accounts for warping/errors)
    use_measured_object_points: true
    measured_points_file: "/workspace/src/eye_in_hand_calibration/config/chess_11x9_3mm_inter.yaml"
    
    # ===========================================
    # CALIBRATION METHOD
    # ===========================================
    
    # Solver algorithm (0=TSAI, 1=PARK, 2=HORAUD, 3=ANDREFF, 4=DANIILIDIS)
    # TSAI: Fast, robust, general use | PARK: Slower, more accurate
    calibration_method: 0
    
    # ===========================================
    # DIVERSITY FILTERING
    # ===========================================

    # Reject samples too similar to previous ones (ensures spatial coverage)
    min_movement_threshold: 0.01       # Min translation between samples (m) - 10mm for endoscope
    min_rotation_threshold: 0.26       # Min rotation between samples (rad) - ~15° for diversity

    # ===========================================
    # ADVANCED FILTERING - SAME AS eyehand_from_yaml.py
    # Filters applied in order:
    # 1. Reprojection error < max_reproj_error_filter
    # 2. min_sensor_camera_distance <= dist <= max_sensor_camera_distance
    # 3. Movement coherence (ALL samples vs REFERENCE with lowest reproj error)
    # 4. Spatial diversity (optional, if use_spatial_diversity=true)
    # ===========================================
    max_reproj_error_filter: 0.8       # Max reprojection error (px)
    min_sensor_camera_distance: 0.008  # Min sensor-camera distance (m) - 8.0mm
    max_sensor_camera_distance: 0.015  # Max sensor-camera distance (m) - 15.0mm
    max_movement_ratio: 1.2            # Max ratio between sensor/camera movement
    max_rotation_diff_deg: 15.0        # Max rotation difference (degrees)

    # Iterative refinement (currently DISABLED in Python)
    use_iterative_refinement: false    # Enable iterative pair selection based on AX≈XB error
    target_pairs: 20                   # Target number of pairs after refinement
    max_refinement_iterations: 50      # Maximum refinement iterations

    # ===========================================
    # SPATIAL DIVERSITY FILTER
    # ===========================================
    use_spatial_diversity: true        # Enable spatial diversity filter
    min_trans_dist_mm: 14.0            # Min translation distance between consecutive samples (mm)
    min_rot_dist_deg: 10.0             # Min rotation distance between consecutive samples (deg)
    target_diverse_samples: 25         # Target number of spatially diverse samples

    # ===========================================
    # NONLINEAR REFINEMENT (Bundle Adjustment)
    # ===========================================
    use_nonlinear_refinement: true     # Enable nonlinear refinement with Levenberg-Marquardt
    refinement_max_iterations: 100     # Maximum iterations for optimizer
    rotation_weight: 10.0              # Weight for rotation errors in optimization
    
    # ===========================================
    # OUTPUT
    # ===========================================
    
    save_result: true                  # Save calibration to timestamped YAML
    result_frame_id: "endo_aurora"     # Source frame (Aurora sensor)
    target_frame_id: "endo_optical"    # Target frame (camera optical center)
    
    # ===========================================
    # DEBUG
    # ===========================================
    
    verbose: true                      # Detailed logging (per-sample metrics, timing)